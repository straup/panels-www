function panels_ui_success(a){alert(a)}function panels_ui_error(a){alert(a)}function panels_ui_confirm(a){return confirm(a)}function panels_ui_prompt(a,c){return prompt(a,c)}function panels_ui_show_controls(){var a=document.getElementById("header-controls"),c=document.getElementById("footer-controls");if(getComputedStyle(a).display=="none")a.style.display="inline";if(c&&getComputedStyle(c).display=="none")c.style.display="inline";return false}
function panels_ui_hide_controls(){var a=document.getElementById("header-controls"),c=document.getElementById("footer-controls");if(getComputedStyle(a).display!="none")a.style.display="none";if(c&&getComputedStyle(c).display!="none")c.style.display="none";return false};var sketchpad=null;function panels_init(){panels_new_panel();panels_load_panels()}
function panels_new_panel(a,c){var b={width:window.innerWidth,height:window.innerHeight*2,editing:true};if(a){try{var d=JSON.parse(a.data);b.strokes=d}catch(e){panels_ui_error("Failed to load that document because "+e);panels_ui_confirm("Should it be removed?")&&panels_delete_panel(c)}if(a.width&&a.width>b.width)b.width=a.width;if(a.height&&a.height>b.height)b.height=a.height}$("#editor").children().remove();sketchpad=Raphael.sketchpad("editor",b);if(c){$("#editor").attr("data-panel-title",c);$("#header-delete").show()}else{$("#editor").removeAttr("data-panel-title");
$("#header-delete").hide()}}
function panels_save_panel(){var a=sketchpad.json();if(panels_is_empty(a)){panels_ui_error("There's nothing to save");return false}var c=$("#editor").attr("data-panel-title");c=panels_ui_prompt("What would you like to call this?",c);if(!c||c==""){panels_ui_error("You need to give this a name, silly.");return false}var b=$("#editor"),d=b.height();b=b.width();panels_storage_save(c,{data:a,height:d,width:b},function(){$("#editor").attr("data-panel-title",c);$("#header-delete").show();panels_load_panels()})}
function panels_load_panels(){panels_storage_list(function(a){for(var c=a.length,b='<option value="-1">...</option>',d=/^pending_(.*)/,e=0;e<c;e++)if(!a[e].match(d)){b+='<option value="';b+=a[e];b+='">';b+=a[e];b+="</option>"}a=document.getElementById("load-sel");a.style.display="block";a.innerHTML=b;document.getElementById("header-select").style.display=c?"inline":"none"})}function panels_open_canvas(a){var c=a.value;panels_storage_load(c,function(b){panels_new_panel(b,c)})}
function panels_delete_panel(a){a||(a=$("#editor").attr("data-panel-title"));if(a){if(!panels_ui_confirm("Are you sure you want to delete "+a+"?"))return false;$("#editor").removeAttr("data-panel-title");panels_storage_remove(a,function(){panels_load_panels()})}else if(!panels_ui_confirm("Are you sure you want to delete this?"))return false;panels_new_panel()}
function panels_upload_panel(){var a=sketchpad.json();if(panels_is_empty(a)){panels_ui_error("there is nothing to upload");return false}a=panels_generate_svg(a);console.log(a);panels_ui_error("uploads are still not working");return false}
function panels_generate_svg(a){a=JSON.parse(a);var c=a.length,b='<?xml version="1.0" standalone="no"?>';b+='<svg xmlns="http://www.w3.org/2000/svg">';for(var d=0;d<c;d++){var e=a[d];b+='<path d="';b+=e.path;b+='" stroke="';b+=e.stroke;b+='" stroke-width="';b+=e["stroke-width"];b+='" stroke-opacity="';b+=e["stroke-opacity"];b+='" stroke-linecap="';b+=e["stroke-linecap"];b+='" stroke-linejoin="';b+=e["stroke-linejoin"];b+='" fill="';b+=e.fill;b+='" />'}b+="</svg>";return b}
function panels_view_source(){var a=sketchpad.json();if(panels_is_empty(a))return false;a=panels_generate_svg(a);a=$("<div/>").text(a).html();$("#svg").html(a)}function panels_is_empty(a){if(!a)return true;if(typeof a=="string"&&a=="[]")return true;if(typeof a=="object"&&a.length==0)return true;return false};function panels_utils_data_uri_to_blob(a){var c;c=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var b=new Uint8Array(c.length),d=0;d<c.length;d++)b[d]=c.charCodeAt(d);return new Blob([b],{type:a})};function panels_storage_save(a,c,b){var d=(new Date).getTime();c.created=d;localforage.setItem(a,c,function(e){b&&b(e)})}function panels_storage_load(a,c){localforage.getItem(a,function(b){c&&c(b)})}function panels_storage_remove(a,c){localforage.removeItem(a,function(b){c&&c(b)})}function panels_storage_list(a){localforage.keys(a)};function panels_upload_schedule_upload(a){var c=window.btoa((new Date).toISOString()),b="pending_"+c;localforage.setItem(b,a,function(){localforage.getItem(b,function(){try{var d=panels_utils_data_uri_to_blob(a)}catch(e){console.log("failed to convert data to blob");console.log(e);return false}panels_upload_schedule_make_it_so(d,c)})})}
function panels_upload_schedule_make_it_so(a,c){var b=new FormData;b.append("photo",a);b.append("access_token",null);b.append("crumb",null);b.append("method",null);var d=new XMLHttpRequest;d.open("POST",null,true);d.onload=function(){if(d.status==200){var e="pending_"+c;localforage.removeItem(e,function(f){console.log("removed "+e);console.log(f)})}else console.log(e)};d.send(b);return false};
